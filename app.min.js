var userId=(new Date).getTime(),fb,startData={map:{lat:-34.397,lng:150.644,zoom:5,mapTypeId:google.maps.MapTypeId.ROADMAP},inControl:userId};window.location.hash?fb=new Firebase("https://mapstash.firebaseio.com/").child(window.location.hash.replace("#","")):(fb=new Firebase("https://mapstash.firebaseio.com/").push(startData),window.location.hash=fb.name()),fb.once("value",function(a){var b=a.val()||startData;window.map=new google.maps.Map(document.getElementById("map"),{zoom:b.map.zoom,center:new google.maps.LatLng(b.map.lat,b.map.lng),mapTypeId:b.map.mapTypeId,streetViewControl:!1});var c=function(){currentData={lat:map.getCenter().lat(),lng:map.getCenter().lng(),zoom:map.getZoom(),mapTypeId:map.getMapTypeId()},fb.set({map:currentData,inControl:userId})},d=[],e=["center_changed","zoom_changed","maptypeid_changed"],f=function(){e.forEach(function(a){d.push(google.maps.event.addListener(map,a,c))})},g=function(){d.forEach(function(a){google.maps.event.removeListener(a)}),d=[]};f(),fb.on("value",function(a){var b=a.val();b&&b.inControl!==userId&&(g(),map.setCenter(new google.maps.LatLng(b.map.lat,b.map.lng)),map.setZoom(b.map.zoom),map.setMapTypeId(b.map.mapTypeId),f())})});